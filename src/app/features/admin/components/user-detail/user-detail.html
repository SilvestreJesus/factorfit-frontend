<div class="flex justify-center sm:justify-end mb-6 px-4">
    <div class="relative w-full max-w-md sm:w-64">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
            class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/70 pointer-events-none">
            <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
        </svg>
        <input type="text" [(ngModel)]="busqueda" (input)="buscar()" placeholder="Buscar usuario..."
            class="w-full bg-pink-500/80 backdrop-blur-md font-bold py-3 pl-10 pr-4 rounded-xl text-white placeholder:text-white/60 outline-none border border-white/20 shadow-lg focus:ring-2 ring-pink-300 transition-all" />

        <ul *ngIf="resultadosBusqueda.length > 0"
            class="absolute w-full bg-white rounded-xl mt-2 z-[100] shadow-2xl border border-gray-100 max-h-60 overflow-y-auto overflow-x-hidden">
            <li *ngFor="let usuario of resultadosBusqueda" (click)="seleccionarUsuario(usuario)"
                class="px-4 py-3 cursor-pointer hover:bg-pink-50 transition-colors border-b last:border-none border-gray-50">
                <p class="font-bold text-pink-600 text-sm">{{ usuario.clave_usuario }}</p>
                <p class="text-gray-800 text-sm font-medium">{{ usuario.nombres }} {{ usuario.apellidos }}</p>
                <small class="text-gray-500 block truncate">{{ usuario.telefono }} | {{ usuario.email }}</small>
            </li>
        </ul>
    </div>
</div>

<div class="container mx-auto px-4 pb-20 max-w-5xl">
    <div class="flex flex-col lg:flex-row gap-8 items-start bg-white/20 backdrop-blur-md p-6 sm:p-10 rounded-3xl border border-white/30 shadow-2xl">
        
        <div class="w-full lg:w-1/3 flex flex-col items-center">
            <h1 class="font-atomic text-pink-600 text-5xl sm:text-6xl mb-6 text-center">Perfil</h1>
            
            <div class="relative group">
                <img [src]="user?.ruta_imagen_mostrar || 'https://placehold.co/200x200/4a0e4e/FFF?text=User'"
                    alt="Foto de perfil"
                    class="w-40 h-40 sm:w-52 sm:h-52 rounded-full object-cover border-4 border-white shadow-xl group-hover:opacity-90 transition-opacity">
                
                <button (click)="fileInput.click()"
                    class="absolute bottom-1 right-1 bg-pink-600 p-3 rounded-full text-white shadow-lg hover:bg-pink-700 active:scale-90 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                    </svg>
                </button>
                <input type="file" accept="image/*" #fileInput hidden (change)="subirFoto($event)" />

                <a [routerLink]="['/admin/usuarios', user?.clave_usuario, 'estadisticas']"
                    class="absolute top-1 right-1 bg-cyan-500 p-3 rounded-full text-white shadow-lg hover:bg-cyan-600 active:scale-90 transition-all"
                    title="Ver estadísticas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <line x1="18" y1="20" x2="18" y2="10" /><line x1="12" y1="20" x2="12" y2="4" /><line x1="6" y1="20" x2="6" y2="14" />
                    </svg>
                </a>
            </div>
            <p class="mt-4 font-bold text-gray-800 text-lg">ID: {{ user?.clave_usuario || '---' }}</p>
        </div>

        <div class="w-full lg:w-2/3">
            <div *ngIf="user" class="space-y-6">
                <form class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Nombre(s)</label>
                            <input type="text" [(ngModel)]="user.nombres" name="nombres" class="input-field">
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Apellidos</label>
                            <input type="text" [(ngModel)]="user.apellidos" name="apellidos" class="input-field">
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Fecha de Nacimiento</label>
                            <input type="date" [(ngModel)]="user.fecha_nacimiento" name="fecha_nacimiento" class="input-field">
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Teléfono</label>
                            <div class="flex gap-2">
                                <select [(ngModel)]="telefonoExtension" name="telefonoExtension" class="input-field w-24 text-center px-1">
                                    <option *ngFor="let ext of extensiones" [value]="ext">{{ ext }}</option>
                                </select>
                                <input type="tel" 
                                    [(ngModel)]="user.telefono" 
                                    name="telefono" 
                                    placeholder="1234567890" 
                                    class="input-field flex-1">
                            </div>
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Peso Inicial</label>
                            <div class="relative">
                                <input type="number" 
                                    [(ngModel)]="user.peso_inicial" 
                                    name="peso_inicial" 
                                    placeholder="Ej. 75"
                                    class="input-field pr-12">
                                <span class="absolute right-4 top-1/2 -translate-y-1/2 font-bold text-gray-500">kg</span>
                            </div>
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Email</label>
                            <input type="email" [(ngModel)]="user.email" name="email" class="input-field">
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Sede</label>
                            <input type="text" [(ngModel)]="user.sede" name="sede" class="input-field">
                        </div>
                        <div class="space-y-1">
                            <label class="text-sm font-bold text-gray-700 ml-1">Status</label>
                            <select [(ngModel)]="user.status" name="status" class="input-field font-bold capitalize">
                                <option value="activo" class="text-green-600">Activo</option>
                                <option value="inactivo" class="text-red-600">Inactivo</option>
                            </select>
                        </div>
                    </div>

                    <button type="button" (click)="guardarCambios()"
                        class="w-full mt-6 bg-pink-600 hover:bg-pink-700 text-white font-black py-4 rounded-2xl shadow-lg shadow-pink-200 transition-all active:scale-[0.98] uppercase tracking-wider">
                        Guardar Cambios
                    </button>
                </form>
            </div>
        </div>
    </div>

    <a routerLink="/admin/usuarios" 
       class="fixed bottom-6 left-6 bg-gray-900 text-white p-4 rounded-2xl shadow-2xl hover:bg-black hover:scale-110 transition-all z-50">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12" />
            <polyline points="12 19 5 12 12 5" />
        </svg>
    </a>
</div>


<div
  *ngIf="toast.visible"
  class="fixed bottom-6 right-6 z-[100] flex items-center gap-3 px-6 py-4 rounded-2xl shadow-2xl text-white transition-all duration-500 animate-in fade-in slide-in-from-right-10"
  [ngClass]="{
    'bg-emerald-600 shadow-emerald-200': toast.tipo === 'success',
    'bg-rose-600 shadow-rose-200': toast.tipo === 'error'
  }">
  
  <svg *ngIf="toast.tipo === 'success'" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
  </svg>
  <svg *ngIf="toast.tipo === 'error'" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
  </svg>

  <span class="font-bold tracking-wide">{{ toast.mensaje }}</span>
</div>